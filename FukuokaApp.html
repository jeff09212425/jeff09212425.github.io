<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>福岡獨旅</title>
    
    <!-- === PWA 設定 (Android 核心修改) === -->
    <meta name="theme-color" content="#121212">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- iOS 設定 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="福岡獨旅">
    
    <!-- App Icon (SVG) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 fill=%22%23121212%22/><text y=%22.9em%22 font-size=%2290%22>⛩️</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 fill=%22%23121212%22/><text y=%22.9em%22 font-size=%2290%22>⛩️</text></svg>">

    <!-- === 內嵌 Manifest (讓 Android 識別為 App 的關鍵) === -->
    <link rel="manifest" href='data:application/manifest+json,{"name":"福岡獨旅","short_name":"福岡獨旅","start_url":".","display":"standalone","background_color":"#121212","theme_color":"#121212","icons":[{"src":"data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 100 100%27%3E%3Crect width=%27100%27 height=%27100%27 fill=%27%23121212%27/%3E%3Ctext y=%27.9em%27 font-size=%2790%27%3E⛩️%3C/text%3E%3C/svg%3E","sizes":"192x192","type":"image/svg+xml"}]}'>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&family=Zen+Old+Mincho:wght@700&display=swap" rel="stylesheet">
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- App Styles -->
    <style>
        :root {
            --bg-body: #121212;
            --brand-gold: #eeb947; 
        }

        body { 
            font-family: 'Noto Sans JP', sans-serif;
            background-color: var(--bg-body);
            color: #ffffff;
            letter-spacing: 0.05em;
            overscroll-behavior-y: none;
            -webkit-tap-highlight-color: transparent;
        }

        h1, h2, h3 { font-weight: 700; letter-spacing: 0.1em; }
        .font-mincho { font-family: 'Zen Old Mincho', serif; }
        .pt-safe-top { padding-top: env(safe-area-inset-top, 20px); }
        .pb-safe-bottom { padding-bottom: env(safe-area-inset-bottom, 20px); }
        
        @keyframes slide-in {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-in {
          animation: slide-in 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Input Styles */
        input, textarea {
            background-color: transparent !important;
            border-bottom: 2px solid #444 !important;
            border-top: none !important;
            border-left: none !important;
            border-right: none !important;
            border-radius: 0 !important;
            padding: 8px 0 !important;
            color: #fff !important;
            font-family: 'Noto Sans JP', sans-serif !important;
            font-weight: 500;
            transition: border-color 0.3s ease;
        }
        input:focus, textarea:focus {
            outline: none !important;
            border-bottom: 2px solid var(--brand-gold) !important;
            ring: 0 !important;
        }
        
        select {
            background-color: #000 !important;
            color: #fff !important;
            border: 1px solid #444 !important;
            border-radius: 4px !important;
            padding: 8px 12px !important;
            font-weight: bold !important;
            -webkit-appearance: none;
        }
        
        option { background-color: #000; color: #fff; padding: 10px; }
        ::placeholder { color: #555; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icons ---
        const Icon = ({ path, size = 18, className = "", fill = "none" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d={path} />
            </svg>
        );

        const Icons = {
            MapPin: (props) => <Icon {...props} path="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z M12 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6" />,
            Plus: (props) => <Icon {...props} path="M12 5v14M5 12h14" />,
            Settings: (props) => <Icon {...props} path="M3 12h18 M3 6h18 M3 18h18" />, 
            Trash: (props) => <Icon {...props} path="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M10 11v6M14 11v6" />,
            Edit: (props) => <Icon {...props} path="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7 M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />,
            X: (props) => <Icon {...props} path="M18 6L6 18M6 6l12 12" />,
            ChevronUp: (props) => <Icon {...props} path="M18 15l-6-6-6 6" />,
            ChevronDown: (props) => <Icon {...props} path="M6 9l6 6 6-6" />,
        };

        const TRIP_DATES_CONFIG = [
            { date: '10/26', day: '月' }, { date: '10/27', day: '火' }, { date: '10/28', day: '水' }, { date: '10/29', day: '木' }, { date: '10/30', day: '金' },
        ];
        
        const INITIAL_CATEGORIES = [
          { id: 'cat1', name: '観光', color: 'text-white border-white' },
          { id: 'cat2', name: '食事', color: 'text-yellow-400 border-yellow-400' },
          { id: 'cat3', name: '買物', color: 'text-white border-white' },
          { id: 'cat4', name: '宿泊', color: 'text-white border-white' },
        ];

        const INITIAL_ITINERARY = [
          { id: '1', date: '10/26', time: '09:00', title: '福岡機場 租車', category: 'cat4', location: 'https://goo.gl/maps/example', notes: '記得檢查護照與日文譯本駕照。', hours: '08:00 - 20:00', closed: '' },
          { id: '2', date: '10/26', time: '10:30', title: '太宰府天滿宮', category: 'cat1', location: '', notes: '必吃梅枝餅！參道星巴克很有名。', hours: '06:00 - 19:00', closed: '無休' },
          { id: '3', date: '10/26', time: '12:30', title: '暖暮拉麵', category: 'cat2', location: 'Danbo Ramen Dazaifu', notes: '如果排隊太長，改去一蘭。', hours: '11:00 - 22:00', closed: '不定休' },
        ];

        function App() {
          const [currentDateObj, setCurrentDateObj] = useState(TRIP_DATES_CONFIG[0]);
          const currentDate = currentDateObj.date;

          const [items, setItems] = useState(() => {
            try { return JSON.parse(localStorage.getItem('fukuoka_trip_items_nishiyama')) || INITIAL_ITINERARY; } catch (e) { return INITIAL_ITINERARY; }
          });
          const [categories, setCategories] = useState(() => {
            try { return JSON.parse(localStorage.getItem('fukuoka_trip_categories_nishiyama')) || INITIAL_CATEGORIES; } catch (e) { return INITIAL_CATEGORIES; }
          });

          const [isEditing, setIsEditing] = useState(false);
          const [showAddModal, setShowAddModal] = useState(false);
          const [showCatModal, setShowCatModal] = useState(false);
          const [editingItem, setEditingItem] = useState(null);
          
          const [formData, setFormData] = useState({ time: '', title: '', category: '', location: '', notes: '', hours: '', closed: '' });
          const [newCatName, setNewCatName] = useState('');

          useEffect(() => { localStorage.setItem('fukuoka_trip_items_nishiyama', JSON.stringify(items)); }, [items]);
          useEffect(() => { localStorage.setItem('fukuoka_trip_categories_nishiyama', JSON.stringify(categories)); }, [categories]);

          const currentItems = items.filter(item => item.date === currentDate);

          const handleOpenLink = (loc) => {
            if(!loc) return;
            if (loc.startsWith('http') || loc.startsWith('goo.gl')) {
                window.open(loc, '_blank');
            } else {
                const query = encodeURIComponent(loc);
                window.open(`https://www.google.com/maps/search/?api=1&query=${query}`, '_blank');
            }
          };

          const deleteItem = (id) => { if (confirm('刪除此行程？')) setItems(items.filter(item => item.id !== id)); };

          const moveItem = (index, direction) => {
            const dayItems = [...currentItems];
            if (direction === 'up' && index > 0) { [dayItems[index], dayItems[index - 1]] = [dayItems[index - 1], dayItems[index]]; }
            else if (direction === 'down' && index < dayItems.length - 1) { [dayItems[index], dayItems[index + 1]] = [dayItems[index + 1], dayItems[index]]; }
            const otherItems = items.filter(item => item.date !== currentDate);
            setItems([...otherItems, ...dayItems]); 
          };

          const handleEditClick = (item) => { setEditingItem(item); setFormData({ ...item }); setShowAddModal(true); };
          const handleAddNewClick = () => { setEditingItem(null); setFormData({ time: '09:00', title: '', category: categories[0]?.id || '', location: '', notes: '', hours: '', closed: '' }); setShowAddModal(true); };

          const handleTimeChange = (type, val) => {
             let [h, m] = formData.time ? formData.time.split(':') : ['09', '00'];
             if (!h) h = '09'; if (!m) m = '00';
             if (type === 'h') h = val;
             if (type === 'm') m = val;
             setFormData({ ...formData, time: `${h}:${m}` });
          };

          const addCategory = () => {
            if (newCatName.trim()) {
                const newCat = { id: Date.now().toString(), name: newCatName, color: 'text-white border-white' };
                setCategories([...categories, newCat]); setNewCatName(''); setFormData(prev => ({...prev, category: newCat.id}));
            }
          };
          const deleteCategory = (id) => {
             if(confirm('確定要刪除此分類嗎？')) {
                 const newCats = categories.filter(c => c.id !== id); setCategories(newCats);
                 if (formData.category === id && newCats.length > 0) setFormData(prev => ({...prev, category: newCats[0].id}));
             }
          };

          const saveItem = () => {
            if (!formData.title) { alert('請輸入標題'); return; }
            const catToSave = formData.category || (categories.length > 0 ? categories[0].id : '');
            if (editingItem) {
              setItems(items.map(item => item.id === editingItem.id ? { ...item, ...formData, category: catToSave, date: currentDate } : item));
            } else {
              const newItem = { id: Date.now().toString(), date: currentDate, ...formData, category: catToSave };
              const newAllItems = [...items, newItem]; newAllItems.sort((a, b) => a.time.localeCompare(b.time)); setItems(newAllItems);
            }
            setShowAddModal(false);
          };
          
          const handleResetData = () => { if(confirm('重置所有資料？')) { localStorage.removeItem('fukuoka_trip_items_nishiyama'); localStorage.removeItem('fukuoka_trip_categories_nishiyama'); window.location.reload(); } }

          const hours = Array.from({length: 24}, (_, i) => i.toString().padStart(2, '0'));
          const minutes = Array.from({length: 12}, (_, i) => (i * 5).toString().padStart(2, '0'));

          return (
            <div className="min-h-screen pb-24 md:pb-10 select-none bg-[#121212] text-[#e0e0e0]">
              <header className="sticky top-0 z-20 bg-[#121212] pt-safe-top transition-all border-b border-[#333]">
                <div className="flex justify-between items-center px-6 py-4">
                  <div>
                    <p className="text-[10px] text-[#eeb947] tracking-[0.2em] font-bold uppercase mb-1">FUKUOKA TRIP</p>
                    <h1 className="text-2xl font-black text-white italic tracking-tighter">福岡獨旅</h1>
                  </div>
                  <button onClick={() => setIsEditing(!isEditing)} className={`p-2 transition-colors ${isEditing ? 'text-[#eeb947]' : 'text-white'}`}>
                    {isEditing ? <Icons.X size={24} /> : <Icons.Settings size={24} />}
                  </button>
                </div>
                <div className="flex overflow-x-auto px-6 pb-4 no-scrollbar gap-5">
                    {TRIP_DATES_CONFIG.map(d => (
                        <button key={d.date} onClick={() => setCurrentDateObj(d)} className={`flex-shrink-0 flex flex-col items-center justify-center w-14 h-16 rounded border transition-all duration-300 ${currentDate === d.date ? 'bg-[#eeb947] border-[#eeb947] text-[#121212] font-bold' : 'bg-transparent border-[#333] text-[#666] hover:border-[#666]'}`}>
                            <span className="text-xs font-bold leading-none mb-1">{d.date}</span>
                            <span className="text-sm font-mincho leading-none">{d.day}</span>
                        </button>
                    ))}
                </div>
              </header>

              <main className="px-5 pt-6 max-w-md mx-auto space-y-6">
                {currentItems.length === 0 && (
                  <div className="text-center py-24 text-[#333]">
                    <div className="flex justify-center mb-6 opacity-30 text-[#eeb947]"><Icons.MapPin size={40} /></div>
                    <p className="text-sm font-bold tracking-widest text-[#666]">NO PLAN</p>
                  </div>
                )}
                {currentItems.map((item, index) => (
                  <div key={item.id} className="relative animate-slide-in">
                    <div className="flex gap-4">
                        <div className="w-14 pt-1 flex flex-col items-center">
                            <span className="text-lg font-black text-[#eeb947] leading-none">{item.time.split(':')[0]}</span>
                            <span className="text-xs font-bold text-[#666]">{item.time.split(':')[1]}</span>
                            {index !== currentItems.length -1 && (
                                <div className="w-[1px] flex-grow bg-[#333] my-2"></div>
                            )}
                        </div>
                        <div className="flex-1 pb-8 border-b border-[#222]">
                            <div className="flex items-center gap-2 mb-2">
                                <h3 className="text-lg font-bold text-white leading-tight">{item.title}</h3>
                                {item.location && (
                                    <button onClick={() => handleOpenLink(item.location)} className="text-[#eeb947] hover:text-white transition-colors p-1">
                                        <Icons.MapPin size={18} fill="#eeb947" />
                                    </button>
                                )}
                            </div>
                            {(item.hours || item.closed) && (
                                <div className="flex flex-wrap gap-4 mb-3 text-[11px] font-medium tracking-wide">
                                    {item.hours && <div className="flex items-center gap-1 text-[#ccc]"><span className="text-[#eeb947]">OPEN</span> {item.hours}</div>}
                                    {item.closed && <div className="flex items-center gap-1 text-[#888]"><span className="text-[#c92a2a]">CLOSE</span> {item.closed}</div>}
                                </div>
                            )}
                            {item.notes && <p className="text-sm text-[#888] leading-relaxed border-l-2 border-[#333] pl-3 py-1">{item.notes}</p>}
                            {isEditing && (
                                <div className="mt-4 flex items-center gap-4">
                                    <button onClick={() => moveItem(index, 'up')} disabled={index === 0} className="p-2 bg-[#222] rounded text-[#888] disabled:opacity-30"><Icons.ChevronUp size={16} /></button>
                                    <button onClick={() => moveItem(index, 'down')} disabled={index === currentItems.length - 1} className="p-2 bg-[#222] rounded text-[#888] disabled:opacity-30"><Icons.ChevronDown size={16} /></button>
                                    <div className="flex-1"></div>
                                    <button onClick={() => handleEditClick(item)} className="px-3 py-1 border border-[#444] text-[10px] font-bold text-[#888] hover:text-white hover:border-white transition-colors">EDIT</button>
                                    <button onClick={() => deleteItem(item.id)} className="px-3 py-1 border border-[#444] text-[10px] font-bold text-[#c92a2a] hover:bg-[#c92a2a] hover:text-white hover:border-[#c92a2a] transition-colors">DEL</button>
                                </div>
                            )}
                        </div>
                    </div>
                  </div>
                ))}
                <div className="pt-12 pb-4 text-center">
                    <button onClick={handleResetData} className="text-[10px] font-bold text-[#333] hover:text-[#666] transition-colors tracking-widest uppercase">Factory Reset</button>
                </div>
                <div className="h-20"></div>
              </main>

              <div className="fixed bottom-8 left-0 right-0 flex justify-center pointer-events-none z-20 pb-safe-bottom">
                <button onClick={handleAddNewClick} className="pointer-events-auto bg-[#eeb947] text-[#121212] rounded-none px-8 py-4 shadow-[0_4px_20px_rgba(238,185,71,0.3)] flex items-center gap-2 active:translate-y-1 transition-all">
                  <Icons.Plus size={20} strokeWidth={3} />
                  <span className="text-xs font-black tracking-[0.1em] uppercase">ADD PLAN</span>
                </button>
              </div>

              {showAddModal && (
                <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center sm:p-4">
                  <div className="absolute inset-0 bg-[#000]/95 backdrop-blur-sm transition-opacity" onClick={() => setShowAddModal(false)}></div>
                  <div className="bg-[#1a1a1a] w-full max-w-md p-8 relative z-10 animate-slide-in pb-safe-bottom border-t-4 border-[#eeb947] sm:border-t-0 sm:border-l-4">
                    <div className="flex justify-between items-center mb-8">
                      <h2 className="text-xl font-black text-white italic tracking-tighter">{editingItem ? 'EDIT PLAN' : 'NEW PLAN'}</h2>
                      <button onClick={() => setShowAddModal(false)} className="text-[#666] hover:text-white"><Icons.X size={24} /></button>
                    </div>
                    <div className="space-y-6">
                      <div className="grid grid-cols-4 gap-6">
                        <div className="col-span-2">
                          <label className="text-[10px] font-bold text-[#eeb947] tracking-widest block mb-2">TIME (24H)</label>
                          <div className="flex gap-2 items-center">
                            <select value={formData.time ? formData.time.split(':')[0] : '09'} onChange={(e) => handleTimeChange('h', e.target.value)} className="flex-1 w-full text-lg text-center">{hours.map(h => <option key={h} value={h}>{h}</option>)}</select>
                            <span className="text-white font-bold">:</span>
                            <select value={formData.time ? formData.time.split(':')[1] : '00'} onChange={(e) => handleTimeChange('m', e.target.value)} className="flex-1 w-full text-lg text-center">{minutes.map(m => <option key={m} value={m}>{m}</option>)}</select>
                          </div>
                        </div>
                        <div className="col-span-2">
                           <label className="text-[10px] font-bold text-[#eeb947] tracking-widest block mb-2">CATEGORY</label>
                           <div className="flex gap-2">
                               <select value={formData.category} onChange={(e) => setFormData({...formData, category: e.target.value})} className="w-full text-base">{categories.map(cat => <option key={cat.id} value={cat.id}>{cat.name}</option>)}</select>
                               <button onClick={() => setShowCatModal(true)} className="bg-[#333] px-3 rounded text-white font-bold hover:bg-[#555]">+</button>
                           </div>
                        </div>
                      </div>
                      <div>
                        <label className="text-[10px] font-bold text-[#eeb947] tracking-widest block mb-1">TITLE</label>
                        <input type="text" placeholder="行程名稱" value={formData.title} onChange={(e) => setFormData({...formData, title: e.target.value})} className="w-full text-xl" />
                      </div>
                      <div>
                        <label className="text-[10px] font-bold text-[#eeb947] tracking-widest block mb-1">MAP LINK</label>
                        <input type="text" placeholder="請貼上 Google Maps 連結" value={formData.location} onChange={(e) => setFormData({...formData, location: e.target.value})} className="w-full text-sm placeholder-[#444]" />
                      </div>
                      <div className="grid grid-cols-2 gap-6">
                          <div><label className="text-[10px] font-bold text-[#eeb947] tracking-widest block mb-1">OPEN</label><input type="text" placeholder="例 11:00-22:00" value={formData.hours} onChange={(e) => setFormData({...formData, hours: e.target.value})} className="w-full text-sm" /></div>
                          <div><label className="text-[10px] font-bold text-[#eeb947] tracking-widest block mb-1">OFF</label><input type="text" placeholder="例 月曜日" value={formData.closed} onChange={(e) => setFormData({...formData, closed: e.target.value})} className="w-full text-sm" /></div>
                      </div>
                      <div>
                        <label className="text-[10px] font-bold text-[#eeb947] tracking-widest block mb-1">MEMO</label>
                        <textarea rows="2" placeholder="備註..." value={formData.notes} onChange={(e) => setFormData({...formData, notes: e.target.value})} className="w-full text-sm resize-none"></textarea>
                      </div>
                      <button onClick={saveItem} className="w-full bg-[#eeb947] text-[#121212] hover:bg-[#ffcd57] py-4 text-sm font-black tracking-[0.2em] mt-2 uppercase transition-colors">SAVE CHANGE</button>
                    </div>
                  </div>
                </div>
              )}

              {showCatModal && (
                 <div className="fixed inset-0 z-[60] flex items-center justify-center p-4">
                   <div className="absolute inset-0 bg-[#000]/80 backdrop-blur-sm" onClick={() => setShowCatModal(false)}></div>
                   <div className="bg-[#1a1a1a] w-full max-w-xs p-6 relative z-10 border border-[#444] shadow-2xl">
                      <div className="flex justify-between items-center mb-4">
                        <h3 className="text-white font-bold">管理分類</h3>
                        <button onClick={() => setShowCatModal(false)} className="text-[#666]"><Icons.X size={18}/></button>
                      </div>
                      <div className="space-y-2 mb-4 max-h-48 overflow-y-auto pr-1">
                        {categories.map(cat => (
                            <div key={cat.id} className="flex justify-between items-center bg-[#222] p-2 rounded border border-[#333]">
                                <span className="text-sm text-white font-bold">{cat.name}</span>
                                <button onClick={() => deleteCategory(cat.id)} className="text-[#c92a2a] hover:text-red-400 p-1"><Icons.Trash size={14}/></button>
                            </div>
                        ))}
                      </div>
                      <div className="flex gap-2">
                          <input type="text" placeholder="新分類名稱" value={newCatName} onChange={(e) => setNewCatName(e.target.value)} className="flex-1 text-sm bg-transparent border-b border-[#666] text-white" />
                          <button onClick={addCategory} className="bg-[#eeb947] text-black px-3 py-1 font-bold text-xs hover:bg-[#ffcd57]">新增</button>
                      </div>
                   </div>
                 </div>
              )}
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>