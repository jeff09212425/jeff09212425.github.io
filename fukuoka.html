<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>福岡獨旅行程表</title>
    
    <!-- 1. 引入 Tailwind CSS (樣式庫) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. 引入 Babel (讓瀏覽器看懂 React JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 3. 設定 Import Map (讓瀏覽器知道去哪裡抓 React 和 Lucide 圖示庫) -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.344.0"
        }
    }
    </script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        /* 基礎樣式覆蓋 */
        :root {
            --font-serif: 'Noto Serif JP', serif;
            --font-sans: 'Noto Sans JP', sans-serif;
            --bg-dark: #121212;
            --bg-card: #1e1e1e;
            --text-main: #e0e0e0;
            --accent-gold: #c5a059;
        }
        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: var(--font-sans);
        }
        /* 隱藏卷軸但保持功能 */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        /* PWA Safe Area */
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        
        /* 修正 Safari/iOS 的一些顯示問題 */
        select { -webkit-appearance: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- 4. 您的 React 程式碼 (type="text/babel" data-type="module") -->
    <script type="text/babel" data-type="module">
        import React, { useState, useRef, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            MapPin, Clock, ExternalLink, Utensils, Bed, Car, 
            ShoppingBag, Camera, Plus, Trash2, GripVertical, 
            Save, X, Link as LinkIcon, Navigation 
        } from 'lucide-react';

        // === 圖片設定區 ===
        // Google Drive 圖片連結常常會失效 (403 Forbidden)。
        // 如果這個連結無法顯示，建議將圖片上傳到 https://postimages.org/ 或 https://imgur.com/ 取得直接連結 (.jpg/.png結尾)。
        const BANNER_IMAGE_URL = "https://lh3.googleusercontent.com/d/1mo1MaLdcHTVJ8KnhX4ijr23dY2QGC7GY"; 
        // 備註：我將您的 drive.google.com/uc 連結轉換成了 lh3.googleusercontent.com 格式，這通常比較穩定。

        // -----------------------------------------------------------------------------
        // 初始數據
        // -----------------------------------------------------------------------------
        const INITIAL_DATA = [
        // 10月26日 (月)
        { id: '1', date: '10月26日', time: '12:40', category: '移動', title: '台北→福岡', link: '', memo: 'AK1510亞航' },
        { id: '2', date: '10月26日', time: '16:00', category: '移動', title: '福岡空港→祇園', link: '', memo: '福岡地下鉄空港線(姪浜行)，從5出站' },
        { id: '3', date: '10月26日', time: '17:30', category: '宿泊', title: 'EN HOTEL Hakata', link: 'https://maps.app.goo.gl/NjExH8YtCALANrc2A', memo: '' },
        { id: '4', date: '10月26日', time: '17:40', category: '移動', title: '櫛田神社前→天神南', link: '', memo: '' },
        { id: '5', date: '10月26日', time: '18:00', category: '食事', title: 'とんかつ わか葉', link: 'https://maps.app.goo.gl/QvWAqUibt5jgBnR59', memo: '宵夜 (10:30-14:30 17:00-20:45)' },

        // 10月27日 (火)
        { id: '6', date: '10月27日', time: '8:00', category: '移動', title: '博多駅貸切バス専用駐車場', link: '', memo: '' },
        { id: '7', date: '10月27日', time: '9:05', category: '觀光', title: '雷山千如寺大悲王院', link: 'https://maps.app.goo.gl/UBBagCVPfjCKPxMr8', memo: '要買Fun Tour 九州巴士' },
        { id: '8', date: '10月27日', time: '11:35', category: '觀光', title: '松月乘船場', link: 'https://maps.app.goo.gl/4rZCWHjYj6ckn9tn6', memo: '柳川觀光開發(株)' },
        { id: '9', date: '10月27日', time: '12:35', category: '食事', title: '清柳食産', link: 'https://maps.app.goo.gl/WAdpLeQJgsJXMmjA8', memo: '替代方案 (公休:水、日)' },
        { id: '10', date: '10月27日', time: '14:55', category: '觀光', title: '太宰府天滿宮', link: 'https://maps.app.goo.gl/o6oDHKprumnZFD3R7', memo: '周邊美食' },
        { id: '11', date: '10月27日', time: '16:45', category: '觀光', title: '寶滿宮 竈門神社', link: 'https://maps.app.goo.gl/uqrcG1tqVnGoXPWbA', memo: '' },
        { id: '12', date: '10月27日', time: '19:00', category: '食事', title: 'とり田 博多本店', link: 'https://maps.app.goo.gl/Wb11R8vxjW6r2XEe9', memo: '' },

        // 10月28日 (水)
        { id: '13', date: '10月28日', time: '8:00', category: '食事', title: '麺屋 いしヰ', link: 'https://maps.app.goo.gl/MB52X8UQCZT16pU4A', memo: '前兩週預定' },
        { id: '14', date: '10月28日', time: '9:00', category: '觀光', title: '櫛田神社', link: 'https://maps.app.goo.gl/mtghzfxJ3yxLpSQ59', memo: '' },
        { id: '15', date: '10月28日', time: '9:45', category: '移動', title: '櫛田神社前→博多', link: '', memo: '' },
        { id: '16', date: '10月28日', time: '10:00', category: '買物', title: '博多阪急', link: 'https://maps.app.goo.gl/xNj1fcEPsyj7NqSU9', memo: '' },
        { id: '17', date: '10月28日', time: '10:00', category: '買物', title: 'LOPIA 博多友都八喜店', link: 'https://maps.app.goo.gl/d3FaqJY3g8iY1XXx8', memo: '' },
        { id: '18', date: '10月28日', time: '12:00', category: '食事', title: 'ひょうたんの回転寿司', link: 'https://maps.app.goo.gl/Z1f9X5d16yLcg5to7', memo: '11:00 - 21:00' },
        { id: '19', date: '10月28日', time: '13:30', category: '買物', title: '天神商圈', link: 'https://www.google.com/maps/d/u/0/edit?mid=1PwbNItMBimR0RkTOnauktSvrmj63OkE&usp=sharing', memo: '' },
        { id: '20', date: '10月28日', time: '17:00', category: '移動', title: '前往 Lalaport福岡', link: 'https://maps.app.goo.gl/fLnwDzqyWMU8ri9B6', memo: '天神大丸前發車' },
        { id: '21', date: '10月28日', time: '17:43', category: '買物', title: 'LaLaport 福岡', link: 'https://maps.app.goo.gl/vH1fHCuazpTYgJDn9', memo: '' },
        { id: '22', date: '10月28日', time: '20:00', category: '食事', title: '博多シーフードうお田', link: 'https://maps.app.goo.gl/1swqRAikHfRMPqXT8', memo: '' },

        // 10月29日 (木)
        { id: '23', date: '10月29日', time: '7:00', category: '食事', title: 'DACOMECCA', link: 'https://maps.app.goo.gl/2nMJPmHuzDismBQM6', memo: '' },
        { id: '24', date: '10月29日', time: '8:30', category: '移動', title: '博多→門司港', link: '', memo: '博多→小倉（新幹線），小倉→門司港 (Pass)' },
        { id: '25', date: '10月29日', time: '9:00', category: '觀光', title: '関門海峡ミュージアム', link: 'https://www.google.com/maps?cid=18212556726394048423', memo: '北九州周遊pass' },
        { id: '26', date: '10月29日', time: '10:00', category: '觀光', title: '門司港レトロ展望室', link: 'https://maps.app.goo.gl/y8YYASgCNzWSY1kJ8', memo: '北九州周遊pass' },
        { id: '27', date: '10月29日', time: '10:30', category: '觀光', title: '和布刈神社', link: 'https://www.google.com/maps?cid=12821316231491149772', memo: '' },
        { id: '28', date: '10月29日', time: '11:30', category: '食事', title: '下関 唐戸市場', link: 'https://maps.app.goo.gl/HHpj4tkK4AfchyxM7', memo: '10:00 - 15:00' },
        { id: '29', date: '10月29日', time: '13:00', category: '觀光', title: '海峡プラザ', link: 'https://maps.app.goo.gl/DNsGw8f6tPRCDKXQ6', memo: '伴手禮小吃' },
        { id: '30', date: '10月29日', time: '14:00', category: '買物', title: 'Aruaru City', link: 'https://maps.app.goo.gl/CAymEorcxp1upN7V7', memo: '' },
        { id: '31', date: '10月29日', time: '15:00', category: '觀光', title: '小倉城', link: 'https://maps.app.goo.gl/gC8GK9sfqSByCvDd8', memo: '北九州周遊pass' },
        { id: '32', date: '10月29日', time: '17:25', category: '移動', title: '接駁車→皿倉山', link: 'https://maps.app.goo.gl/B2M9SUyakKSLbLhe8', memo: '八幡站搭車' },
        { id: '33', date: '10月29日', time: '17:45', category: '觀光', title: '皿倉山夜景', link: '', memo: 'ケーブルカー' },
        { id: '34', date: '10月29日', time: '21:30', category: '食事', title: '肉いち 博多店', link: 'https://maps.app.goo.gl/tW2M4KA1tEDXbHVH6', memo: '2個月前要網路訂位' },

        // 10月30日 (金)
        { id: '35', date: '10月30日', time: '8:00', category: '食事', title: '炉端ノいとおかし', link: 'https://maps.app.goo.gl/8tfxDmg16DShtsKJ8', memo: '近1個月要網路訂位' },
        { id: '36', date: '10月30日', time: '9:30', category: '食事', title: 'パンストック 天神店', link: 'https://maps.app.goo.gl/TWVyCXm3144BsL6s7', memo: '' },
        { id: '37', date: '10月30日', time: '10:00', category: '買物', title: '博多運河城', link: 'https://maps.app.goo.gl/A5dHucXhqsb9vDZU6', memo: '' },
        { id: '38', date: '10月30日', time: '12:30', category: '食事', title: '博多元氣一杯!!', link: 'https://www.google.com/maps?cid=4563141796542890085', memo: '' },
        { id: '39', date: '10月30日', time: '14:30', category: '移動', title: '福岡國際機場', link: '', memo: 'AK1511 回家' },
        ];

        const WEEKDAYS = {
        '10月26日': '月',
        '10月27日': '火',
        '10月28日': '水',
        '10月29日': '木',
        '10月30日': '金',
        };

        const CATEGORIES = [
        { name: '移動', color: 'text-blue-400', bg: 'bg-blue-400/10', border: 'border-blue-400/30', icon: Car },
        { name: '宿泊', color: 'text-indigo-400', bg: 'bg-indigo-400/10', border: 'border-indigo-400/30', icon: Bed },
        { name: '食事', color: 'text-orange-400', bg: 'bg-orange-400/10', border: 'border-orange-400/30', icon: Utensils },
        { name: '觀光', color: 'text-emerald-400', bg: 'bg-emerald-400/10', border: 'border-emerald-400/30', icon: Camera },
        { name: '買物', color: 'text-pink-400', bg: 'bg-pink-400/10', border: 'border-pink-400/30', icon: ShoppingBag },
        { name: '其他', color: 'text-gray-400', bg: 'bg-gray-400/10', border: 'border-gray-400/30', icon: MapPin },
        ];

        // -----------------------------------------------------------------------------
        // 子組件
        // -----------------------------------------------------------------------------

        const EditModal = ({ item, isOpen, onClose, onSave, onDelete, categories, setCategories }) => {
        const [formData, setFormData] = useState(item);
        const [newCatName, setNewCatName] = useState('');
        const [isAddingCat, setIsAddingCat] = useState(false);

        useEffect(() => {
            if (item) setFormData(item);
        }, [item]);

        if (!isOpen || !formData) return null;

        const handleChange = (e) => {
            setFormData({ ...formData, [e.target.name]: e.target.value });
        };

        const handleAddCategory = () => {
            if (newCatName.trim()) {
            setCategories([...categories, { 
                name: newCatName, 
                color: 'text-gold', 
                bg: 'bg-yellow-500/10', 
                border: 'border-yellow-500/30', 
                icon: MapPin 
            }]);
            setFormData({ ...formData, category: newCatName });
            setNewCatName('');
            setIsAddingCat(false);
            }
        };

        return (
            <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/80 backdrop-blur-sm p-0 sm:p-4 animate-in fade-in duration-200">
            <div className="bg-[#1e1e1e] w-full max-w-md rounded-t-2xl sm:rounded-2xl border border-white/10 shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
                {/* Modal Header */}
                <div className="flex justify-between items-center p-4 border-b border-white/10">
                <h3 className="text-lg font-serif font-bold text-white">編輯行程</h3>
                <button onClick={onClose} className="p-2 hover:bg-white/10 rounded-full text-gray-400">
                    <X size={20} />
                </button>
                </div>

                {/* Modal Body */}
                <div className="p-5 space-y-5 overflow-y-auto custom-scrollbar">
                
                <div className="grid grid-cols-2 gap-4">
                    <div className="space-y-1">
                    <label className="text-xs text-gray-500">時間</label>
                    <input 
                        type="time" 
                        name="time"
                        value={formData.time || ''} 
                        onChange={handleChange}
                        className="w-full bg-[#2a2a2a] border border-white/10 rounded-lg p-3 text-white focus:border-[#c5a059] focus:outline-none"
                    />
                    </div>
                    
                    <div className="space-y-1">
                    <label className="text-xs text-gray-500">分類</label>
                    {!isAddingCat ? (
                        <div className="flex gap-2">
                        <select 
                            name="category"
                            value={formData.category || ''} 
                            onChange={handleChange}
                            className="w-full bg-[#2a2a2a] border border-white/10 rounded-lg p-3 text-white focus:border-[#c5a059] focus:outline-none appearance-none"
                        >
                            {categories.map(c => <option key={c.name} value={c.name}>{c.name}</option>)}
                        </select>
                        <button onClick={() => setIsAddingCat(true)} className="p-3 bg-[#2a2a2a] rounded-lg border border-white/10 text-gray-400 hover:text-[#c5a059]">
                            <Plus size={18} />
                        </button>
                        </div>
                    ) : (
                        <div className="flex gap-2">
                        <input 
                            type="text" 
                            placeholder="新分類名稱"
                            value={newCatName}
                            onChange={(e) => setNewCatName(e.target.value)}
                            className="w-full bg-[#2a2a2a] border border-white/10 rounded-lg p-3 text-white focus:border-[#c5a059]"
                            autoFocus
                        />
                        <button onClick={handleAddCategory} className="px-3 bg-[#c5a059] text-black font-bold rounded-lg text-sm">
                            OK
                        </button>
                        </div>
                    )}
                    </div>
                </div>

                <div className="space-y-1">
                    <label className="text-xs text-gray-500">標題</label>
                    <input 
                    type="text" 
                    name="title"
                    value={formData.title || ''} 
                    onChange={handleChange}
                    className="w-full bg-[#2a2a2a] border border-white/10 rounded-lg p-3 text-white focus:border-[#c5a059] focus:outline-none font-medium"
                    />
                </div>

                <div className="space-y-1">
                    <label className="text-xs text-gray-500 flex items-center gap-2">
                    <LinkIcon size={12} /> 地圖/網站連結 (Map Link)
                    </label>
                    <input 
                    type="text" 
                    name="link"
                    placeholder="https://..."
                    value={formData.link || ''} 
                    onChange={handleChange}
                    className="w-full bg-[#2a2a2a] border border-white/10 rounded-lg p-3 text-blue-400 text-sm focus:border-[#c5a059] focus:outline-none"
                    />
                </div>

                <div className="space-y-1">
                    <label className="text-xs text-gray-500">備註 (支援超連結)</label>
                    <textarea 
                    name="memo"
                    rows={3}
                    value={formData.memo || ''} 
                    onChange={handleChange}
                    placeholder="例如：需預約，網址：https://..."
                    className="w-full bg-[#2a2a2a] border border-white/10 rounded-lg p-3 text-gray-300 text-sm focus:border-[#c5a059] focus:outline-none resize-none"
                    />
                </div>

                <button 
                    onClick={() => onDelete(formData.id)}
                    className="w-full py-3 flex items-center justify-center gap-2 text-red-400 bg-red-400/10 rounded-lg hover:bg-red-400/20 transition-colors"
                >
                    <Trash2 size={16} /> 刪除此行程
                </button>
                </div>

                {/* Modal Footer */}
                <div className="p-4 border-t border-white/10 bg-[#1e1e1e]">
                <button 
                    onClick={() => onSave(formData)}
                    className="w-full py-3 bg-[#c5a059] hover:bg-[#b08d4a] text-black font-bold rounded-lg shadow-lg shadow-[#c5a059]/20 transition-all flex items-center justify-center gap-2"
                >
                    <Save size={18} /> 儲存變更
                </button>
                </div>
            </div>
            </div>
        );
        };

        // -----------------------------------------------------------------------------
        // 主應用程式
        // -----------------------------------------------------------------------------
        const FukuokaSoloTripApp = () => {
        const [activeDate, setActiveDate] = useState('10月26日');
        const [items, setItems] = useState(INITIAL_DATA);
        const [categories, setCategories] = useState(CATEGORIES);
        const [editingItem, setEditingItem] = useState(null);
        
        // Drag & Drop State
        const dragItem = useRef();
        const dragOverItem = useRef();

        // Helper: 取得分類樣式
        const getCatStyle = (catName) => {
            return categories.find(c => c.name === catName) || categories[categories.length - 1];
        };

        // Helper: 處理備註內的連結
        const renderMemoWithLinks = (text) => {
            if (!text) return null;
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            const parts = text.split(urlRegex);
            return (
            <span className="break-words">
                {parts.map((part, i) => 
                part.match(urlRegex) ? (
                    <a key={i} href={part} target="_blank" rel="noopener noreferrer" className="text-blue-400 underline decoration-blue-400/50 underline-offset-2 hover:text-blue-300" onClick={(e) => e.stopPropagation()}>
                    連結
                    </a>
                ) : part
                )}
            </span>
            );
        };

        // Logic: 拖曳排序
        const handleDragStart = (e, position) => {
            dragItem.current = position;
            // 手機震動反饋
            if (navigator.vibrate) navigator.vibrate(50);
        };

        const handleDragEnter = (e, position) => {
            dragOverItem.current = position;
        };

        const handleDrop = () => {
            if (dragItem.current === null || dragOverItem.current === null) return;
            
            // 只在同一天內排序
            const currentDayItems = items.filter(i => i.date === activeDate);
            const otherItems = items.filter(i => i.date !== activeDate);
            
            const copyListItems = [...currentDayItems];
            const dragItemContent = copyListItems[dragItem.current];
            
            copyListItems.splice(dragItem.current, 1);
            copyListItems.splice(dragOverItem.current, 0, dragItemContent);
            
            setItems([...otherItems, ...copyListItems]);
            
            dragItem.current = null;
            dragOverItem.current = null;
        };

        // Logic: CRUD
        const handleSave = (newItem) => {
            setItems(items.map(i => i.id === newItem.id ? newItem : i));
            setEditingItem(null);
        };

        const handleDelete = (id) => {
            if (confirm('確定要刪除這個行程嗎？')) {
            setItems(items.filter(i => i.id !== id));
            setEditingItem(null);
            }
        };

        const handleAddNew = () => {
            const newItem = {
            id: Date.now().toString(),
            date: activeDate,
            time: '00:00',
            category: '移動',
            title: '新行程',
            link: '',
            memo: ''
            };
            setItems([...items, newItem]);
            setEditingItem(newItem);
        };

        const filteredItems = items.filter(item => item.date === activeDate);
        const uniqueDates = Object.keys(WEEKDAYS);

        return (
            <div className="min-h-screen pb-20 safe-bottom selection:bg-[#c5a059] selection:text-black">
            
            {/* 1. Hero Banner */}
            <div className="relative h-64 w-full overflow-hidden bg-black">
                <div className="absolute inset-0 bg-gradient-to-b from-transparent via-[#121212]/50 to-[#121212] z-10" />
                <img 
                src={BANNER_IMAGE_URL} 
                onError={(e) => {
                    e.target.onerror = null; 
                    // 備用圖片：若連結失效，顯示一張通用的日本夜景
                    e.target.src = "https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=2564&auto=format&fit=crop";
                }}
                alt="Fukuoka Trip Banner" 
                className="w-full h-full object-cover opacity-80"
                />
                <div className="absolute bottom-4 left-6 z-20">
                <h1 className="text-4xl font-serif font-bold text-white tracking-wider mb-1" style={{ textShadow: '0 2px 10px rgba(0,0,0,0.5)' }}>
                    福岡獨旅
                </h1>
                <div className="h-1 w-12 bg-[#c5a059] rounded-full" />
                </div>
            </div>

            {/* 2. Date Navigation (Sticky) */}
            <div className="sticky top-0 z-40 bg-[#121212]/95 backdrop-blur-md border-b border-white/5 shadow-lg">
                <div className="flex overflow-x-auto no-scrollbar py-3 px-4 gap-3">
                {uniqueDates.map((date) => {
                    const isActive = activeDate === date;
                    return (
                    <button
                        key={date}
                        onClick={() => setActiveDate(date)}
                        className={`flex flex-col items-center justify-center min-w-[60px] py-2 rounded-xl transition-all duration-300 ${
                        isActive 
                            ? 'bg-[#c5a059] text-[#121212] shadow-[0_0_15px_rgba(197,160,89,0.3)] transform scale-105' 
                            : 'bg-[#1e1e1e] text-gray-400 border border-white/5'
                        }`}
                    >
                        <span className={`text-xs font-bold font-serif mb-1 ${isActive ? 'text-[#121212]' : 'text-gray-500'}`}>
                        {date}
                        </span>
                        <span className={`text-lg font-bold ${isActive ? 'text-black' : 'text-gray-300'}`}>
                        {WEEKDAYS[date]}
                        </span>
                    </button>
                    );
                })}
                </div>
            </div>

            {/* 3. Itinerary List */}
            <div className="px-4 py-6 max-w-lg mx-auto">
                {filteredItems.length === 0 ? (
                <div className="text-center py-20 text-gray-600 flex flex-col items-center">
                    <Camera size={48} className="mb-4 opacity-20" />
                    <p className="text-sm font-serif">今日暫無行程</p>
                    <button onClick={handleAddNew} className="mt-4 text-[#c5a059] text-sm hover:underline">
                    新增一個行程
                    </button>
                </div>
                ) : (
                <div className="space-y-4">
                    {filteredItems.map((item, index) => {
                    const style = getCatStyle(item.category);
                    const Icon = style.icon;
                    
                    return (
                        <div 
                        key={item.id}
                        className="group relative bg-[#1e1e1e] rounded-xl border border-white/5 overflow-hidden transition-all duration-300 hover:border-[#c5a059]/30 hover:shadow-lg active:scale-[0.99]"
                        draggable
                        onDragStart={(e) => handleDragStart(e, index)}
                        onDragEnter={(e) => handleDragEnter(e, index)}
                        onDragEnd={handleDrop}
                        onDragOver={(e) => e.preventDefault()}
                        onClick={() => setEditingItem(item)}
                        >
                        <div className="flex items-stretch min-h-[5rem]">
                            {/* Left: Time & Decorative Line */}
                            <div className="w-16 flex flex-col items-center justify-center border-r border-white/5 bg-[#252525]">
                            <span className="text-sm font-bold text-gray-300 font-mono tracking-tighter">
                                {item.time}
                            </span>
                            <div className={`h-8 w-[1px] my-1 ${style.bg.replace('/10', '/50')}`} />
                            <Icon size={14} className={style.color} />
                            </div>

                            {/* Center: Content */}
                            <div className="flex-1 p-3 flex flex-col justify-center min-w-0">
                            <div className="flex items-center gap-2 mb-1">
                                <span className={`text-[10px] font-bold px-1.5 py-0.5 rounded border ${style.color} ${style.bg} ${style.border}`}>
                                {item.category}
                                </span>
                            </div>
                            <h3 className="text-base font-bold text-gray-100 truncate pr-2 font-serif leading-tight">
                                {item.title}
                            </h3>
                            {(item.memo || item.link) && (
                                <div className="mt-2 flex flex-wrap gap-2 text-xs text-gray-400">
                                    {item.link && (
                                    <a 
                                        href={item.link} 
                                        target="_blank" 
                                        rel="noopener noreferrer" 
                                        className="flex items-center gap-1 text-[#c5a059] hover:text-white transition-colors bg-[#c5a059]/10 px-2 py-0.5 rounded"
                                        onClick={(e) => e.stopPropagation()}
                                    >
                                        <Navigation size={10} /> 導航
                                    </a>
                                    )}
                                    {item.memo && (
                                    <span className="flex-1 truncate opacity-70 border-l border-gray-600 pl-2">
                                        {renderMemoWithLinks(item.memo)}
                                    </span>
                                    )}
                                </div>
                            )}
                            </div>

                            {/* Right: Drag Handle */}
                            <div className="w-8 flex items-center justify-center text-gray-600 cursor-grab active:cursor-grabbing hover:text-gray-400 bg-gradient-to-l from-black/20 to-transparent">
                            <GripVertical size={16} />
                            </div>
                        </div>
                        </div>
                    );
                    })}
                </div>
                )}
            </div>

            {/* 4. Floating Action Button */}
            <button 
                onClick={handleAddNew}
                className="fixed bottom-6 right-6 w-14 h-14 bg-[#c5a059] text-black rounded-full shadow-[0_4px_20px_rgba(197,160,89,0.4)] flex items-center justify-center hover:bg-[#d4b06a] hover:scale-110 transition-all z-30"
            >
                <Plus size={28} />
            </button>

            {/* 5. Edit Modal */}
            <EditModal 
                key={editingItem ? editingItem.id : 'edit-modal'} // 強制重置 Modal 狀態
                item={editingItem} 
                isOpen={!!editingItem} 
                onClose={() => setEditingItem(null)} 
                onSave={handleSave}
                onDelete={handleDelete}
                categories={categories}
                setCategories={setCategories}
            />

            </div>
        );
        };

        // 渲染 App
        const root = createRoot(document.getElementById('root'));
        root.render(<FukuokaSoloTripApp />);
    </script>
</body>
</html>
